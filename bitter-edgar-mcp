#!/bin/bash
# Bitter Edgar MCP Server - Standalone executable
# Auto-detects and activates Poetry virtualenv

set -e

# Get the directory where this script lives
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Change to bitter-edgar directory
cd "$SCRIPT_DIR"

# Use absolute path to poetry (in case PATH isn't set)
POETRY_BIN="${POETRY_BIN:-$HOME/.local/bin/poetry}"

# Find the Poetry virtualenv
VENV_PATH=$("$POETRY_BIN" env info --path 2>/dev/null || echo "")

if [ -z "$VENV_PATH" ]; then
    echo "Error: Poetry virtualenv not found. Run 'poetry install' first." >&2
    exit 1
fi

# Activate virtualenv and run server
exec "$VENV_PATH/bin/python" -m bitter_edgar.server "$@"
